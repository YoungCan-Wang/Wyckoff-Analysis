# A è‚¡é€‰è‚¡ä¸è¡Œæƒ…å·¥å…·

> æ¯å¤©ä»å…¨å¸‚åœºç­›é€‰å‡º**æœ€å€¼å¾—æ¬¡æ—¥æ“ä½œçš„ 6 åªè‚¡ç¥¨**ï¼Œå¹¶ç”Ÿæˆ AI ç ”æŠ¥ï¼›åŒæ—¶æ”¯æŒè¡Œæƒ…æ•°æ®æŸ¥è¯¢ä¸ CSV å¯¼å‡ºã€‚

ç”¨ [akshare](https://github.com/akfamily/akshare) + è‡ªç ” Wyckoff æ¼æ–—åšé‡åŒ–åˆç­›ï¼Œå†ç”¨å¤§æ¨¡å‹åšæ·±åº¦åˆ†æã€‚é€‚åˆæƒ³å¿«é€Ÿæ‹¿åˆ°æ¯æ—¥ã€Œæ˜æ—¥å¯ä¹°æ¸…å•ã€çš„ A è‚¡æŠ•èµ„è€…ã€‚

**åœ¨çº¿ä½“éªŒï¼š** [https://wyckoff-analysis-youngcanphoenix.streamlit.app/](https://wyckoff-analysis-youngcanphoenix.streamlit.app/)

---

## ä½ èƒ½åšä»€ä¹ˆ

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| ğŸ“Š **æ¯æ—¥é€‰è‚¡** | é…ç½® GitHub Actions åï¼Œå·¥ä½œæ—¥ 16:30 è‡ªåŠ¨è·‘ Wyckoff Funnelï¼Œä»ä¸»æ¿+åˆ›ä¸šæ¿ç­›å‡º 6 åªï¼Œæ¨é€åˆ°é£ä¹¦ |
| ğŸ¤– **AI ç ”æŠ¥** | å¯¹ç­›é€‰ç»“æœç”Ÿæˆè§‚å¯Ÿæ±  + æ“ä½œæ± ï¼Œå«æŠ€æœ¯ç»“æ„ã€é˜»åŠ›ä½ã€äº¤æ˜“è®¡åˆ’ç­‰ |
| ğŸ“ **è¡Œæƒ…å¯¼å‡º** | Web æˆ–å‘½ä»¤è¡Œæ‹‰å–æŒ‡å®šè‚¡ç¥¨æ—¥çº¿ï¼Œå¯¼å‡ºåŸå§‹/å¢å¼ºä¸¤ä»½ CSVï¼ˆOHLCV å¼€é«˜ä½æ”¶é‡ç­‰ï¼‰ |
| ğŸ” **ç™»å½•ä¸é…ç½®** | æ”¯æŒç™»å½•ã€é£ä¹¦ Webhookã€API Key äº‘ç«¯åŒæ­¥ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒ

éœ€è¦ **Python 3.10+**ã€‚

```bash
cd akshare
python3 -m venv .venv
source .venv/bin/activate   # Windows: .venv\Scripts\activate
python -m pip install -U pip
python -m pip install -r requirements.txt
```

### 2. é…ç½®

å¤åˆ¶ `.env.example` ä¸º `.env`ï¼Œå¡«å…¥ï¼š

- `SUPABASE_URL`ã€`SUPABASE_KEY`ï¼šç™»å½•ç”¨ï¼ˆé¡¹ç›®ä¾èµ– Supabaseï¼‰
- `FEISHU_WEBHOOK_URL`ï¼ˆå¯é€‰ï¼‰ï¼šé£ä¹¦æ¨é€åœ°å€

### 3. è¿è¡Œ

**Web ç•Œé¢ï¼ˆæ¨èï¼‰**ï¼šæµè§ˆå™¨é‡ŒæŸ¥æ•°æ®ã€ä¸‹ CSVã€‚

```bash
streamlit run streamlit_app.py
```

**å‘½ä»¤è¡Œ**ï¼šæ‰¹é‡å¯¼å‡ºã€‚

```bash
python fetch_a_share_csv.py --symbol 300364
python -u fetch_a_share_csv.py --symbols 000973 600798 601390
```

---

## ğŸ“… æ¯æ—¥é€‰è‚¡ï¼ˆWyckoff Funnelï¼‰

ä»å…¨å¸‚åœºï¼ˆä¸»æ¿ + åˆ›ä¸šæ¿ï¼‰å¤šè½®è¿‡æ»¤ï¼Œæœ€ç»ˆè¾“å‡º**æœ€å€¼å¾—æ¬¡æ—¥æ“ä½œçš„ 6 åªè‚¡ç¥¨**ï¼Œå¹¶ç”Ÿæˆ AI ç ”æŠ¥ï¼Œæ¨é€åˆ°é£ä¹¦ã€‚

### å¯ç”¨æ–¹å¼

ä»“åº“å†…ç½®å·¥ä½œæµï¼š`.github/workflows/wyckoff_funnel.yml`

- **å®šæ—¶**ï¼šå·¥ä½œæ—¥ 16:30ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
- **æ‰‹åŠ¨**ï¼šActions é¡µé¢é€‰æ‹© `Wyckoff Funnel` â†’ `Run workflow`

### é…ç½® GitHub Secrets

`Settings` â†’ `Secrets and variables` â†’ `Actions`ï¼Œæ·»åŠ ï¼š

| åç§° | å¿…å¡« | è¯´æ˜ |
|------|------|------|
| `FEISHU_WEBHOOK_URL` | æ˜¯ | æ¥æ”¶é€‰è‚¡ç»“æœä¸ç ”æŠ¥ |
| `GEMINI_API_KEY` | æ˜¯ | AI ç ”æŠ¥ |
| `TUSHARE_TOKEN` | æ˜¯ | è¡Œæƒ…ä¸å¸‚å€¼æ•°æ® |
| `GEMINI_MODEL` | å¦ | æœªé…åˆ™ç”¨é»˜è®¤æ¨¡å‹ |

### éªŒè¯

è·‘ä¸€æ¬¡æ‰‹åŠ¨è§¦å‘åï¼Œæ£€æŸ¥ï¼š

- æ—¥å¿—ä¸­æœ‰ `é˜¶æ®µæ±‡æ€»` ä¸” `ok=True`
- Artifacts ä¸­æœ‰ `daily-job-logs-*`
- é£ä¹¦æ”¶åˆ°æ¼æ–—ç»“æœ + ç ”æŠ¥

### é»˜è®¤è¡Œä¸ºå¥‘çº¦ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰

- è‚¡ç¥¨æ± èŒƒå›´ï¼šä¸»æ¿ + åˆ›ä¸šæ¿ï¼Œè‡ªåŠ¨å‰”é™¤ STã€‚
- æ¼æ–—æµç¨‹ï¼š`Layer1 -> Layer2 -> Layer3 -> Layer4`ï¼Œå…¶ä¸­æ—¥çº¿æŒ‰æ‰¹æ¬¡æ‹‰å–å¹¶åœ¨æ‰¹æ¬¡å†…å…ˆåš L1/L2ã€‚
- å®è§‚æ€»é—¸ï¼šä¼šæ³¨å…¥å¤§ç›˜æ°´æ¸©ï¼ˆRISK_ON / NEUTRAL / RISK_OFFï¼‰å¹¶åŠ¨æ€è°ƒå‚ã€‚
- AI è¾“å…¥ï¼šå‘æ¨¡å‹ä¼ å…¥â€œæ¼æ–—å‘½ä¸­çš„å…¨é‡å€™é€‰â€ï¼Œä¸æ˜¯åªä¼  6 åªã€‚
- AI è¾“å‡ºç›®æ ‡ï¼šå…ˆäº§å‡ºè§‚å¯Ÿæ± ï¼ˆæ•°é‡ä¸é™ï¼Œå«è§‚å¯Ÿæ¡ä»¶ï¼‰ï¼Œå†äº§å‡ºæ“ä½œæ± ï¼ˆå›ºå®š 6 åªï¼‰ã€‚
- é£ä¹¦æ¨é€ï¼šé•¿å†…å®¹ä¼šè‡ªåŠ¨åˆ†ç‰‡å‘é€ï¼Œé¿å…è¶…é•¿æˆªæ–­ã€‚

### æ‰§è¡Œæ—¶é•¿ä¸è¿›åº¦åˆ¤æ–­ï¼ˆSLAï¼‰

- å¸¸è§„è€—æ—¶ï¼šçº¦ `90~130` åˆ†é’Ÿï¼ˆå—ç½‘ç»œã€æ•°æ®æºã€å€™é€‰è§„æ¨¡å½±å“ï¼‰ã€‚
- å…³é”®è¿›åº¦æ—¥å¿—ï¼š
  - `[funnel] æ‰¹æ¬¡#x/y å¯åŠ¨`ï¼šå¼€å§‹å¤„ç†æŸä¸€æ‰¹è‚¡ç¥¨ã€‚
  - `[funnel] æ‰¹æ¬¡#x å®Œæˆ`ï¼šè¯¥æ‰¹æ‹‰å–ä¸ L1/L2 å·²ç»“æŸã€‚
  - `[funnel] L1=... L2=... L3=... å‘½ä¸­=...`ï¼šæ¼æ–—æ±‡æ€»å®Œæˆã€‚
  - `[step3] AI è¾“å…¥è‚¡ç¥¨æ•°=...`ï¼šå·²è¿›å…¥å¤§æ¨¡å‹ç ”æŠ¥é˜¶æ®µã€‚
  - `=== é˜¶æ®µæ±‡æ€» ===`ï¼šå…¨æµç¨‹ç»“æŸï¼ˆä»¥è¯¥æ®µä¸ºå‡†ï¼‰ã€‚

### æ•…éšœæ’æŸ¥çŸ©é˜µï¼ˆå…ˆçœ‹è¿™ä¸ªï¼‰

| ç—‡çŠ¶ï¼ˆæ—¥å¿—ï¼‰ | å¸¸è§åŸå›  | å¤„ç†å»ºè®® |
|------|------|------|
| `é…ç½®ç¼ºå¤±: FEISHU_WEBHOOK_URL` | æœªé…ç½®é£ä¹¦ Secret | åœ¨ä»“åº“ Secrets æ·»åŠ  `FEISHU_WEBHOOK_URL` |
| `é…ç½®ç¼ºå¤±: GEMINI_API_KEY` | æœªé…ç½®æ¨¡å‹ Key æˆ–å·²å¤±æ•ˆ | æ›´æ–° `GEMINI_API_KEY` åé‡è·‘ |
| `å¸‚å€¼æ•°æ®ä¸ºç©ºï¼ˆTUSHARE_TOKEN å¯èƒ½ç¼ºå¤±/å¤±æ•ˆï¼‰` | `TUSHARE_TOKEN` ç¼ºå¤±/å¤±æ•ˆ/é¢åº¦é—®é¢˜ | æ£€æŸ¥å¹¶æ›´æ–° `TUSHARE_TOKEN`ï¼Œç¡®è®¤è´¦å·æƒé™ |
| `[step3] æ¨¡å‹ ... å¤±è´¥` / `llm_failed` | æ¨¡å‹ä¸å¯ç”¨ã€é™æµã€ç½‘ç»œæŠ–åŠ¨ | æ›´æ¢ `GEMINI_MODEL` æˆ–ç¨åé‡è¯• |
| `[step3] é£ä¹¦æ¨é€å¤±è´¥` / `feishu_failed` | Webhook æ— æ•ˆã€é™æµã€ç½‘ç»œé—®é¢˜ | é‡æ–°ç”Ÿæˆé£ä¹¦æœºå™¨äºº Webhook å¹¶æ›¿æ¢ Secret |
| Action è¶…æ—¶æˆ–æ˜æ˜¾æ…¢äº 2 å°æ—¶ | æ•°æ®æºæŠ–åŠ¨ã€é‡è¯•å˜å¤š | æŸ¥çœ‹æ‰¹æ¬¡æ—¥å¿—å®šä½å¡ç‚¹ï¼Œå¿…è¦æ—¶æ‰‹åŠ¨é‡è·‘ |

---

## äº¤æµè¯·åŠ é£ä¹¦ç¾¤

![é£ä¹¦ç¾¤äºŒç»´ç ](attach/é£ä¹¦20260202-185128.png)

---

## é™„å½•

### ç›®å½•ç»“æ„

```text
.
â”œâ”€â”€ fetch_a_share_csv.py    # æ•°æ®æ‹‰å–ã€CSV ç”Ÿæˆ
â”œâ”€â”€ streamlit_app.py        # Web å…¥å£
â”œâ”€â”€ wyckoff_engine.py       # 4 å±‚æ¼æ–—å¼•æ“
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ wyckoff_funnel.py   # å®šæ—¶é€‰è‚¡ä»»åŠ¡
â”‚   â”œâ”€â”€ step3_batch_report.py  # AI ç ”æŠ¥
â”‚   â””â”€â”€ daily_job.py        # æ—¥ç»ˆæµæ°´çº¿
â”œâ”€â”€ requirements.txt
â””â”€â”€ .env.example
```

### äº¤æ˜“æ—¥ä¸æ—¶é—´çª—å£

æŒ‰äº¤æ˜“æ—¥è®¡ç®—ï¼Œè‡ªåŠ¨è·³è¿‡å‘¨æœ«ä¸èŠ‚å‡æ—¥ã€‚

- ç»“æŸæ—¥ï¼šç³»ç»Ÿæ—¥æœŸ - 1 å¤©ï¼Œå¯¹é½åˆ°æœ€è¿‘äº¤æ˜“æ—¥
- å¼€å§‹æ—¥ï¼šä»ç»“æŸæ—¥å‘å‰å›æº¯ N ä¸ªäº¤æ˜“æ—¥ï¼ˆé»˜è®¤ 500ï¼‰
- å‚æ•°ï¼š`--trading-days`ã€`--end-offset-days`

### CSV è¾“å‡ºè¯´æ˜

- **hist_data.csv**ï¼šakshare åŸå§‹å­—æ®µï¼ˆæ—¥æœŸã€å¼€é«˜ä½æ”¶ã€æˆäº¤é‡ã€æˆäº¤é¢ã€æŒ¯å¹…ã€æ¢æ‰‹ç‡ç­‰ï¼‰
- **ohlcv.csv**ï¼šå¢å¼ºç‰ˆï¼ˆOHLCV + å‡ä»·ã€è¡Œä¸šï¼‰ï¼Œä¾¿äºå›æµ‹ä¸å¯è§†åŒ–

### å¤æƒ

`--adjust`ï¼š`""` ä¸å¤æƒï¼Œ`qfq` å‰å¤æƒï¼Œ`hfq` åå¤æƒã€‚

```bash
python fetch_a_share_csv.py --symbol 300364 --adjust qfq
```

### å¸¸è§é—®é¢˜

- **ImportError: create_client from supabase** â†’ `pip install supabase>=2.0.0`
- **macOS pip externally-managed-environment** â†’ ç”¨è™šæ‹Ÿç¯å¢ƒå®‰è£…ä¾èµ–
- **æ–‡ä»¶åæœ‰ç©ºæ ¼** â†’ è‚¡ç¥¨åæœ¬èº«å¸¦ç©ºæ ¼ï¼Œè„šæœ¬ä¼šåšå®‰å…¨æ›¿æ¢

### Fork ä¸éƒ¨ç½²

1. Fork æœ¬ä»“åº“ï¼Œå…‹éš†åˆ°æœ¬åœ°
2. æŒ‰ä¸Šæ–‡é…ç½® `.env` åè¿è¡Œ
3. éƒ¨ç½²åˆ° [Streamlit Cloud](https://share.streamlit.io/)ï¼šå…¥å£é€‰ `streamlit_app.py`ï¼ŒSecrets é… `SUPABASE_URL`ã€`SUPABASE_KEY`ã€`COOKIE_SECRET`

[![Open in Streamlit](https://static.streamlit.io/badges/streamlit_badge_black_white.svg)](https://share.streamlit.io/)

---

## ç‰ˆæœ¬æ›´æ–°

è¯¦è§ [`CHANGELOG.md`](CHANGELOG.md)ã€‚Web ç«¯ã€Œç‰ˆæœ¬æ›´æ–°æ—¥å¿—ã€é¡µé¢ç›´æ¥è¯»å–è¯¥æ–‡ä»¶ã€‚
