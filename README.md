# A è‚¡é€‰è‚¡ä¸è¡Œæƒ…å·¥å…·

> æ¯å¤©ä»å…¨å¸‚åœºç­›é€‰å‡º**æœ€å€¼å¾—æ¬¡æ—¥æ“ä½œçš„ 6 åªè‚¡ç¥¨**ï¼Œå¹¶ç”Ÿæˆ AI ç ”æŠ¥ï¼›åŒæ—¶æ”¯æŒè¡Œæƒ…æ•°æ®æŸ¥è¯¢ä¸ CSV å¯¼å‡ºã€‚

ç”¨ [akshare](https://github.com/akfamily/akshare) + è‡ªç ” Wyckoff æ¼æ–—åšé‡åŒ–åˆç­›ï¼Œå†ç”¨å¤§æ¨¡å‹åšæ·±åº¦åˆ†æã€‚é€‚åˆæƒ³å¿«é€Ÿæ‹¿åˆ°æ¯æ—¥ã€Œæ˜æ—¥å¯ä¹°æ¸…å•ã€çš„ A è‚¡æŠ•èµ„è€…ã€‚

**åœ¨çº¿ä½“éªŒï¼š** [https://wyckoff-analysis-youngcanphoenix.streamlit.app/](https://wyckoff-analysis-youngcanphoenix.streamlit.app/)

---

## ä½ èƒ½åšä»€ä¹ˆ

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| ğŸ“Š **æ¯æ—¥é€‰è‚¡** | é…ç½® GitHub Actions åï¼Œå·¥ä½œæ—¥ 16:30 è‡ªåŠ¨è·‘ Wyckoff Funnelï¼Œä»ä¸»æ¿+åˆ›ä¸šæ¿ç­›å‡º 6 åªï¼Œæ¨é€åˆ°é£ä¹¦ |
| ğŸ¤– **AI ç ”æŠ¥** | å¯¹ç­›é€‰ç»“æœç”Ÿæˆè§‚å¯Ÿæ±  + æ“ä½œæ± ï¼Œå«æŠ€æœ¯ç»“æ„ã€é˜»åŠ›ä½ã€äº¤æ˜“è®¡åˆ’ç­‰ |
| ğŸ•¶ï¸ **ç§äººå†³æ–­** | ç»“åˆä¸ªäººæŒä»“ä¸å¤–éƒ¨å€™é€‰ï¼Œç”Ÿæˆ Buy/Hold/Sell ç§å¯†æŒ‡ä»¤ï¼Œå¹¶é€šè¿‡ Telegram å•ç‹¬å‘é€ |
| ğŸ“ **è¡Œæƒ…å¯¼å‡º** | Web æˆ–å‘½ä»¤è¡Œæ‹‰å–æŒ‡å®šè‚¡ç¥¨æ—¥çº¿ï¼Œå¯¼å‡ºåŸå§‹/å¢å¼ºä¸¤ä»½ CSVï¼ˆOHLCV å¼€é«˜ä½æ”¶é‡ç­‰ï¼‰ |
| ğŸ” **ç™»å½•ä¸é…ç½®** | æ”¯æŒç™»å½•ã€é£ä¹¦ Webhookã€API Key äº‘ç«¯åŒæ­¥ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒ

éœ€è¦ **Python 3.10+**ã€‚

```bash
cd akshare
python3 -m venv .venv
source .venv/bin/activate   # Windows: .venv\Scripts\activate
python -m pip install -U pip
python -m pip install -r requirements.txt
```

### 2. é…ç½®

å¤åˆ¶ `.env.example` ä¸º `.env`ï¼Œå¡«å…¥ï¼š

- `SUPABASE_URL`ã€`SUPABASE_KEY`ï¼šç™»å½•ç”¨ï¼ˆé¡¹ç›®ä¾èµ– Supabaseï¼‰
- `FEISHU_WEBHOOK_URL`ï¼ˆå¯é€‰ï¼‰ï¼šé£ä¹¦æ¨é€åœ°å€

### 3. è¿è¡Œ

**Web ç•Œé¢ï¼ˆæ¨èï¼‰**ï¼šæµè§ˆå™¨é‡ŒæŸ¥æ•°æ®ã€ä¸‹ CSVã€‚

```bash
streamlit run streamlit_app.py
```

**å‘½ä»¤è¡Œ**ï¼šæ‰¹é‡å¯¼å‡ºã€‚

```bash
python -m integrations.fetch_a_share_csv --symbol 300364
python -u -m integrations.fetch_a_share_csv --symbols 000973 600798 601390
```

---

## ğŸ“… æ¯æ—¥é€‰è‚¡ï¼ˆWyckoff Funnelï¼‰

ä»å…¨å¸‚åœºï¼ˆä¸»æ¿ + åˆ›ä¸šæ¿ï¼‰å¤šè½®è¿‡æ»¤ï¼Œæœ€ç»ˆè¾“å‡º**æœ€å€¼å¾—æ¬¡æ—¥æ“ä½œçš„ 6 åªè‚¡ç¥¨**ï¼Œå¹¶ç”Ÿæˆ AI ç ”æŠ¥ï¼Œæ¨é€åˆ°é£ä¹¦ã€‚

### å¯ç”¨æ–¹å¼

ä»“åº“å†…ç½®å·¥ä½œæµï¼š`.github/workflows/wyckoff_funnel.yml`

- **å®šæ—¶**ï¼šå·¥ä½œæ—¥ 16:30ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
- **æ‰‹åŠ¨**ï¼šActions é¡µé¢é€‰æ‹© `Wyckoff Funnel` â†’ `Run workflow`

### é…ç½® GitHub Secrets

`Settings` â†’ `Secrets and variables` â†’ `Actions`ï¼Œæ·»åŠ ï¼š

| åç§° | å¿…å¡« | è¯´æ˜ |
|------|------|------|
| `FEISHU_WEBHOOK_URL` | æ˜¯ | æ¥æ”¶é€‰è‚¡ç»“æœä¸ç ”æŠ¥ |
| `GEMINI_API_KEY` | æ˜¯ | AI ç ”æŠ¥ |
| `TUSHARE_TOKEN` | æ˜¯ | è¡Œæƒ…ä¸å¸‚å€¼æ•°æ® |
| `GEMINI_MODEL` | å¦ | æœªé…åˆ™ç”¨é»˜è®¤æ¨¡å‹ |
| `MY_PORTFOLIO_STATE` | Step4 ç”¨ | å¯é€‰ï¼Œæ ¼å¼è§ `.env.example` |
| `TG_BOT_TOKEN` | Step4 ç”¨ | å¯é€‰ |
| `TG_CHAT_ID` | Step4 ç”¨ | å¯é€‰ |

### éªŒè¯

è·‘ä¸€æ¬¡æ‰‹åŠ¨è§¦å‘åï¼Œæ£€æŸ¥ï¼š

- æ—¥å¿—ä¸­æœ‰ `é˜¶æ®µæ±‡æ€»` ä¸” `ok=True`
- Artifacts ä¸­æœ‰ `daily-job-logs-*`
- é£ä¹¦æ”¶åˆ°æ¼æ–—ç»“æœ + ç ”æŠ¥

å¸¸è§„è·‘å®Œçº¦ 90ï½130 åˆ†é’Ÿã€‚æŠ¥é”™æ—¶çœ‹æ—¥å¿—é‡Œç¼ºå“ªä¸ªé…ç½®ã€‚

### å¸¸è§æŠ¥é”™

- `é…ç½®ç¼ºå¤±: FEISHU_WEBHOOK_URL`
  - åŸå› ï¼šæœªé…ç½®é£ä¹¦ Secret
  - å¤„ç†ï¼šåœ¨ä»“åº“ Secrets æ·»åŠ  `FEISHU_WEBHOOK_URL`
- `é…ç½®ç¼ºå¤±: GEMINI_API_KEY`
  - åŸå› ï¼šæœªé…ç½®æ¨¡å‹ Key æˆ–å·²å¤±æ•ˆ
  - å¤„ç†ï¼šæ›´æ–° `GEMINI_API_KEY` åé‡è·‘
- `å¸‚å€¼æ•°æ®ä¸ºç©ºï¼ˆTUSHARE_TOKEN å¯èƒ½ç¼ºå¤±/å¤±æ•ˆï¼‰`
  - åŸå› ï¼š`TUSHARE_TOKEN` ç¼ºå¤±/å¤±æ•ˆ/é¢åº¦é—®é¢˜
  - å¤„ç†ï¼šæ£€æŸ¥å¹¶æ›´æ–° `TUSHARE_TOKEN`ï¼Œç¡®è®¤è´¦å·æƒé™
- `[step3] æ¨¡å‹ ... å¤±è´¥` / `llm_failed`
  - åŸå› ï¼šæ¨¡å‹ä¸å¯ç”¨ã€é™æµã€ç½‘ç»œæŠ–åŠ¨
  - å¤„ç†ï¼šæ›´æ¢ `GEMINI_MODEL` æˆ–ç¨åé‡è¯•
- `[step3] é£ä¹¦æ¨é€å¤±è´¥` / `feishu_failed`
  - åŸå› ï¼šWebhook æ— æ•ˆã€é™æµã€ç½‘ç»œé—®é¢˜
  - å¤„ç†ï¼šé‡æ–°ç”Ÿæˆé£ä¹¦æœºå™¨äºº Webhook å¹¶æ›¿æ¢ Secret
- `é˜¶æ®µ 3 ç§äººå†å¹³è¡¡: è·³è¿‡ï¼ˆMY_PORTFOLIO_STATE æœªé…ç½®ï¼‰`
  - åŸå› ï¼šæœªé…ç½®è´¦æˆ·çŠ¶æ€
  - å¤„ç†ï¼šé…ç½® `MY_PORTFOLIO_STATE` åé‡è·‘
- `é˜¶æ®µ 3 ç§äººå†å¹³è¡¡: è·³è¿‡ï¼ˆTG_BOT_TOKEN/TG_CHAT_ID æœªé…ç½®ï¼‰`
  - åŸå› ï¼šæœªé…ç½® Telegram
  - å¤„ç†ï¼šé…ç½® Telegram Secrets åé‡è·‘
- `User location is not supported for the API use`
  - åŸå› ï¼šæ¨¡å‹åœ°åŸŸé™åˆ¶
  - å¤„ç†ï¼šæ›´æ¢å¯ç”¨ç½‘ç»œå‡ºå£æˆ–ä¾›åº”å•†
- `Action è¶…æ—¶æˆ–æ˜æ˜¾æ…¢äº 2 å°æ—¶`
  - åŸå› ï¼šæ•°æ®æºæŠ–åŠ¨ã€é‡è¯•å˜å¤š
  - å¤„ç†ï¼šæŸ¥çœ‹æ‰¹æ¬¡æ—¥å¿—å®šä½å¡ç‚¹ï¼Œå¿…è¦æ—¶æ‰‹åŠ¨é‡è·‘

### ç§äººå†³æ–­ï¼ˆå¯é€‰ï¼‰

è‹¥é…ç½®äº†æŒä»“å’Œ Telegramï¼Œé€‰è‚¡å’Œç ”æŠ¥è·‘å®Œåä¼šå•ç‹¬å‘ä¸€ä»½ã€Œé’ˆå¯¹ä½ è´¦æˆ·çš„ä¹°å–å»ºè®®ã€åˆ°ä½ çš„ Telegramï¼Œåªæœ‰ä½ èƒ½çœ‹åˆ°ã€‚ä¸é…åˆ™è·³è¿‡ï¼Œä¸å½±å“é€‰è‚¡å’Œç ”æŠ¥ã€‚

è´¦æˆ·æ ¼å¼è§ `.env.example`ã€‚å…¶ä¸­ `total_equity` æ˜¯å¯é€‰å­—æ®µï¼Œä¸å¡«ä¼šè‡ªåŠ¨æŒ‰â€œ`free_cash + æŒä»“æœ€æ–°å¸‚å€¼`â€æ¨å¯¼ã€‚TG_CHAT_ID éœ€å…ˆç»™ bot å‘ `/start`ï¼Œå†ä» getUpdates è¿”å›é‡Œå– chat.idã€‚

---

## äº¤æµ

### é£ä¹¦ç¾¤äºŒç»´ç 

![é£ä¹¦ç¾¤äºŒç»´ç ](attach/é£ä¹¦ç¾¤äºŒç»´ç .png)

### é£ä¹¦ä¸ªäººäºŒç»´ç 

![é£ä¹¦ä¸ªäººäºŒç»´ç ](attach/é£ä¹¦ä¸ªäººäºŒç»´ç .png)

---

## é™„å½•

### ç›®å½•ç»“æ„

```text
.
â”œâ”€â”€ streamlit_app.py        # Web å…¥å£
â”œâ”€â”€ app/                    # UI ç»„ä»¶ï¼ˆlayout/auth/navigationï¼‰
â”œâ”€â”€ core/                   # æ ¸å¿ƒç­–ç•¥ä¸é¢†åŸŸé€»è¾‘
â”œâ”€â”€ integrations/           # æ•°æ®æº/LLM/Supabase é€‚é…å±‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ wyckoff_funnel.py   # å®šæ—¶é€‰è‚¡ä»»åŠ¡
â”‚   â”œâ”€â”€ step3_batch_report.py  # AI ç ”æŠ¥
â”‚   â”œâ”€â”€ step4_rebalancer.py   # ç§äººå†³æ–­
â”‚   â””â”€â”€ daily_job.py        # æ—¥ç»ˆæµæ°´çº¿
â”œâ”€â”€ requirements.txt
â””â”€â”€ .env.example
```

### äº¤æ˜“æ—¥ä¸æ—¶é—´çª—å£

æŒ‰äº¤æ˜“æ—¥è®¡ç®—ï¼Œè‡ªåŠ¨è·³è¿‡å‘¨æœ«ä¸èŠ‚å‡æ—¥ã€‚

- ç»“æŸæ—¥ï¼šç³»ç»Ÿæ—¥æœŸ - 1 å¤©ï¼Œå¯¹é½åˆ°æœ€è¿‘äº¤æ˜“æ—¥
- å¼€å§‹æ—¥ï¼šä»ç»“æŸæ—¥å‘å‰å›æº¯ N ä¸ªäº¤æ˜“æ—¥ï¼ˆé»˜è®¤ 500ï¼‰
- å‚æ•°ï¼š`--trading-days`ã€`--end-offset-days`

### CSV è¾“å‡ºè¯´æ˜

- **hist_data.csv**ï¼šakshare åŸå§‹å­—æ®µï¼ˆæ—¥æœŸã€å¼€é«˜ä½æ”¶ã€æˆäº¤é‡ã€æˆäº¤é¢ã€æŒ¯å¹…ã€æ¢æ‰‹ç‡ç­‰ï¼‰
- **ohlcv.csv**ï¼šå¢å¼ºç‰ˆï¼ˆOHLCV + å‡ä»·ã€è¡Œä¸šï¼‰ï¼Œä¾¿äºå›æµ‹ä¸å¯è§†åŒ–

### å¤æƒ

`--adjust`ï¼š`""` ä¸å¤æƒï¼Œ`qfq` å‰å¤æƒï¼Œ`hfq` åå¤æƒã€‚

```bash
python -m integrations.fetch_a_share_csv --symbol 300364 --adjust qfq
```

### å¸¸è§é—®é¢˜

- **ImportError: create_client from supabase** â†’ `pip install supabase>=2.0.0`
- **macOS pip externally-managed-environment** â†’ ç”¨è™šæ‹Ÿç¯å¢ƒå®‰è£…ä¾èµ–
- **æ–‡ä»¶åæœ‰ç©ºæ ¼** â†’ è‚¡ç¥¨åæœ¬èº«å¸¦ç©ºæ ¼ï¼Œè„šæœ¬ä¼šåšå®‰å…¨æ›¿æ¢

### Fork ä¸éƒ¨ç½²

1. Fork æœ¬ä»“åº“ï¼Œå…‹éš†åˆ°æœ¬åœ°
2. æŒ‰ä¸Šæ–‡é…ç½® `.env` åè¿è¡Œ
3. éƒ¨ç½²åˆ° [Streamlit Cloud](https://share.streamlit.io/)ï¼šå…¥å£é€‰ `streamlit_app.py`ï¼ŒSecrets é… `SUPABASE_URL`ã€`SUPABASE_KEY`ã€`COOKIE_SECRET`

[![Open in Streamlit](https://static.streamlit.io/badges/streamlit_badge_black_white.svg)](https://share.streamlit.io/)

---

## ç‰ˆæœ¬æ›´æ–°

è¯¦è§ [`CHANGELOG.md`](CHANGELOG.md)ã€‚Web ç«¯ã€Œç‰ˆæœ¬æ›´æ–°æ—¥å¿—ã€é¡µé¢ç›´æ¥è¯»å–è¯¥æ–‡ä»¶ã€‚
